<!DOCTYPE html>
<html lang="uk">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta charset="UTF-8" />
    <title>Генерація і сортування зображень</title>
</head>
<body>
    <h1>Генерація і сортування зображень</h1>

    <!-- Форма для генерації -->
    <form id="generateForm">
        <label>Запит 1: <input type="text" name="target1" required /></label>
        <label>Запит 2: <input type="text" name="target2" required /></label>
        <label>Кількість: <input type="number" name="quantity" min="1" max="20" value="5" required /></label>
        <button type="submit">Згенерувати</button>
    </form>

    <!-- Контейнер з зображеннями -->
    <div class="image-container" id="imagesContainer">
        {% for image in images %}
        <div class="image-box">
            <img src="{{ url_for('static', filename='generated_images/' + image) }}" alt="{{ image }}" />
            <label><input type="checkbox" name="selected_images" value="{{ image }}" /> Обрати</label>
        </div>
        {% endfor %}
    </div>

    <br/>
    <button id="sortBtn">Сортувати вибрані</button>

<script>
    // Відправляємо форму генерації через fetch (POST JSON)
    document.getElementById('generateForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = {
            target1: formData.get('target1'),
            target2: formData.get('target2'),
            quantity: formData.get('quantity'),
        };

        const response = await fetch('/generate', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });

        if (response.ok) {
            alert('Зображення згенеровано!');
            location.reload();
        } else {
            alert('Помилка генерації.');
        }
    });

    // Кнопка сортування — відправляємо вибрані зображення на сервер
    document.getElementById('sortBtn').addEventListener('click', async () => {
        const checkedBoxes = document.querySelectorAll('input[name="selected_images"]:checked');
        const selected = Array.from(checkedBoxes).map(cb => cb.value);
        if(selected.length === 0) {
            alert('Оберіть хоча б одне зображення для сортування!');
            return;
        }

        // Для прикладу: сортуємо в папку Positive (можна зробити інтерфейс вибору)
        const data = {
            selected_images: selected,
            folder_path: 'Positive'
        };

        const response = await fetch('/sort', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });

        const result = await response.json();
        if(response.ok) {
            alert(result.message);
            location.reload();
        } else {
            alert(result.error || 'Помилка сортування.');
        }
    });
</script>

<!-- Додано нижче кнопки "Сортувати вибрані" -->
<br/>
<br/><br/>
<button id="uploadTikTokBtn">Викласти в TikTok</button>

<script>
    // ... (код генерації і сортування залишився)

    // Кнопка викладання в TikTok
    document.getElementById('uploadTikTokBtn').addEventListener('click', async () => {
        const checkedBoxes = document.querySelectorAll('input[name="selected_images"]:checked');
        const selected = Array.from(checkedBoxes).map(cb => cb.value);
        if (selected.length === 0) {
            alert('Оберіть хоча б одне зображення для викладання!');
            return;
        }

        const data = {
            selected_images: selected
        };

        const response = await fetch('/upload_tiktok', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });

        const result = await response.json();
        if (response.ok) {
            alert(result.message || 'Зображення викладено в TikTok!');
        } else {
            alert(result.error || 'Помилка викладання в TikTok.');
        }
    });
</script>

</body>
</html>
